:: Widgets Tentacles [widget]
<<widget "tentaclestart">><<nobr>>
<<set $enemyarousalmax to 10000>>

<<set $alltentacles to []>>

/* Ideally tentacleno would be a widget argument and everything would just check $alltentacles.length */
<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<set $alltentacles.push({ name: $tentaclenames[$tentacleindex], health: $tentaclehealth, head: 0, shaft: 0 })>>
<</for>>

<</nobr>><</widget>>

<<widget "tentacles">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    $tentacleindex
    <<tentacleact>><br>
<</for>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<set $alltentacles[$tentacleindex].health -= 0.2>>
<</for>>

<<if $panicattacks gte 1 and $panicviolence is 0 and $panicparalysis is 0 and $controlled is 0>>
	<<set $rng to random(1, 100)>>
	<<if $rng is 100>>
	<<set $panicparalysis to 10>>
	<</if>>
<</if>>

<<if $panicattacks gte 2 and $panicviolence is 0 and $panicparalysis is 0 and $controlled is 0>>
	<<set $rng to random(1, 100)>>
	<<if $rng is 100>>
	<<set $panicviolence to 3>>
	<</if>>
<</if>>

<<if $arousal gte 10000>>

<<orgasmpassage>>

<</if>>

<<set $seconds += 10>>
<<if $seconds gte 60>>
<<set $seconds to 0>>
<<pass 1>>
<</if>>

<br>
<</nobr>><</widget>>

<<widget "effectstentacles">><<nobr>>

<<effectspain>>
<<effectsorgasm>>
<<effectsdissociation>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<effectstentacle>><br>
<</for>>

<br><br>
<</nobr>><</widget>>

<<widget "actionstentacles">><<nobr>>

<<set $enemyarousal to $arousal>>

<<if $vorecreature is 0 and $swarmcount lte 0>>
	<<if $images is 1>><<timed 100ms>>
	<<combatimg>>
	<br>
	<</timed>><</if>>
<</if>>

<<actioncarry>>
<<actioncarrydrop>>

<<if $trance lte 0 and $dissociation lte 1 and $panicparalysis is 0 and $panicviolence is 0 and $orgasmdown lte 0 and $pain lt 100>>

<<if $leftarm is 0>>Your left arm is free.<br><</if>>
<<actionstentacleslefthand>>

<<if $rightarm is 0>>Your right arm is free.<br><</if>>
<<actionstentaclesrighthand>>

<<if $leftleg is 0 and $rightleg is 0>>
Your legs are free.<br>
<<elseif $leftleg is 0>>
Your left leg is free.<br>
<<elseif $rightleg is 0>>
Your right leg is free.<br>
<<elseif $leftleg is "grappled" and $rightleg is "grappled">>
Your legs are entangled and forced apart, leaving you less able to protect your <<genitalsstop>><br>
<</if>>
<<actionstentacleslegs>>

/* This could be moved to init to avoid redundant reinitializations, but that would make it less readable */
/* Format is: variable to compare to value, value, tentacle head check, message if variable == value ({0} is replaced with tentacle's name) */
<<set $tentaclethreatenmessages to {
    mouth: [
        [ "$mouthstate", "tentacleentrance", "mouthentrance", "The {0} tentacle threatens your mouth." ],
        [ "$mouthstate", "tentacleimminent", "mouthentrance", "The {0} tentacle presses against your mouth." ],
        [ "$mouthstate", "tentacle", "mouthentrance", "The {0} tentacle thrusts into your mouth." ],
        [ "$mouthstate", "tentacledeep", "mouthdeep", "The {0} tentacle thrusts into your mouth, ejaculating down your throat." ]
    ],
    vagina: [
        [ "$vaginastate", "tentacleentrance", "vaginaentrance", "The {0} tentacle threatens your <<pussystop>>" ],
        [ "$vaginastate", "tentacleimminent", "vaginaimminent", "The {0} tentacle presses against your <<pussycomma>> about to penetrate." ],
        [ "$vaginastate", "tentacle", "vagina", "The {0} tentacle thrusts into your <<pussystop>>" ],
        [ "$vaginastate", "tentacledeep", "vaginadeep", "The {0} tentacle thrusts into your <<pussycomma>> ejaculating deep into your womb." ],
        [ "$vaginause", "tentaclerub", "vaginarub", "The {0} tentacle runs between your thighs, pressing against your labia and continuing to your tummy." ]
    ],
    penis: [
        [ "$penisstate", "tentacleentrance", "penisentrance", "The {0} tentacle threatens your <<penisstop>>" ],
        [ "$penisstate", "tentacleimminent", "penisimminent", "The {0} tentacle presses against your <<peniscomma>> about to engulf." ],
        [ "$penisstate", "tentacle", "penis", "The {0} tentacle envelops and pounds your <<penisstop>>" ],
        [ "$penisstate", "tentacledeep", "penisdeep", "The {0} tentacle envelops and pounds your <<penisstop>>" ],
        [ "$penisuse", "tentaclerub", "penisrub", "The {0} tentacle runs between your thighs, coiling around your <<penis>> and pressing against your tummy." ]
    ],
    anus: [
        [ "$anusstate", "tentacleentrance", "anusentrance", "The {0} tentacle threatens your <<bottomstop>>" ],
        [ "$anusstate", "tentacleimminent", "anusimminent", "The {0} tentacle presses against your <<bottomcomma>> about to penetrate." ],
        [ "$anusstate", "tentacle", "anus", "The {0} tentacle thrusts into your <<bottomstop>>" ],
        [ "$anusstate", "tentacledeep", "anusdeep", "The {0} tentacle thrusts into your <<bottomcomma>> ejaculating deep into your bowels." ]
    ],
    bottom: [
        [ "$bottomuse", "tentaclerub", "bottomrub", "The {0} tentacle rubs itself between your butt cheeks." ]
    ],
    chest: [
        [ "$breastuse", "tentacle", "chest", "The {0} tentacle rubs itself between your <<breastsstop>>" ]
    ]
}>>

<<tentacleonbodypart "mouth">>
<<actionstentaclesmouth>>

<<tentacleonbodypart "vagina">>
<<actionstentaclesvagina>>

<<tentacleonbodypart "penis">>
<<actionstentaclespenis>>

<<tentacleonbodypart "anus">>
<<actionstentaclesanus>>

<<tentacleonbodypart "thighs">>
<<actionstentaclesthighs>>

<<tentacleonbodypart "bottom">>
<<actionstentaclesbottom>>

<<tentacleonbodypart "chest">>
<<actionstentacleschest>>

<</if>>


<<combatstate>>
<<carryblock>>

<br>
<</nobr>><</widget>>

<<widget "tentacleonbodypart">><<nobr>>

<<set $currentbodypart to $args[0]>>
<<set $curbodypartwarnings to $tentaclethreatenmessages[$currentbodypart]>>

<<for _m to 0; _m lt $tentaclethreatenmessages.length; _m++>>
    <<set _currentmsg to $tentaclethreatenmessages[_m]>>
    /* State.getVar isn't pretty, but it's more readable than huge blocks of ifs */
    <<if State.getVar(_currentmsg[0]) is _currentmsg[1]>>
        /* Find matching tentacle */
        <<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
            <<if $alltentacles[$tentacleindex].head is _currentmsg[2]>>
                /* Replace {0} with tentacle name, then print the message */
                <<print String.format(_currentmsg[3], $alltentacles[$tentacleindex].name)>>
                <br>
            <</if>>
        <</for>>
    <</if>>
<</for>>

<</nobr>><</widget>>

<<widget "actionstentacleschest">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclechest>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentaclesbottom">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclebottom>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentaclesthighs">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclethighs>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentaclesanus">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentacleanus>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentaclespenis">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclepenis>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentaclesvagina">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclevagina>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentaclesmouth">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclemouth>>
<</for>>
<br>
<</nobr>><</widget>>


<<widget "actionstentacleslegs">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclelegs>>
<</for>>

<</nobr>><</widget>>


<<widget "actionstentaclesrighthand">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclerighthand>>
<</for>>

<</nobr>><</widget>>


<<widget "actionstentacleslefthand">><<nobr>>

<<for $tentacleindex to 0; $tentacleindex lt $tentacleno; $tentacleindex++>>
    <<actionstentaclelefthand>>
<</for>>

<</nobr>><</widget>>

<<widget "upperslither">><<nobr>>

<<if $upperclothes isnot "naked">>
then <<slithers>> beneath your $upperclothes
<<else>>
then <<slithers>> across your bare skin
<</if>>

<</nobr>><</widget>>

<<widget "lowerslither">><<nobr>>

<<if $lowerclothes isnot "naked">>
then <<slithers>> beneath your $lowerclothes
<<else>>
then <<slithers>> across your bare skin
<</if>>

<</nobr>><</widget>>

<<widget "underslither">><<nobr>>

<<if $lowerclothes isnot "naked">>
	<<if $undertype isnot "naked" and $undertype isnot "chastity">>
	then <<slithers>> beneath your $lowerclothes and $underclothes
	<<elseif $undertype is "chastity">>
	then <<slithers>> beneath your $lowerclothes against your chastity belt
	<<else>>
	<</if>>
<<else>>
	<<if $undertype isnot "naked" and $undertype isnot "chastity">>
	then <<slithers>> beneath your $underclothes
	<<elseif $undertype is "chastity">>
	then <<slithers>> against your chastity belt
	<<else>>
	then <<slithers>> across your bare skin
	<</if>>
<</if>>

<</nobr>><</widget>>

<<widget "statetentacles">><<nobr>>

<<set $activetentacleno to $tentacleno>>
<<for _i to 0; _i lt $tentacleno; _i++>>
    <<if $alltentacles[_i].shaft is "finished">>
        <<set $activetentacleno -= 1>>
    <</if>>
<</for>>

<</nobr>><</widget>>
